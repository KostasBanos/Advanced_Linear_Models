<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Konstantinos Banos">
<meta name="dcterms.date" content="2024-12-20">

<title>Project 5 – STATS 720 Portfolio — Konstantinos Banos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STATS 720 Portfolio — Konstantinos Banos</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Project_1.html"> 
<span class="menu-text">Project 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Project_2.html"> 
<span class="menu-text">Project 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Project_3.html"> 
<span class="menu-text">Project 3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Project_4.html"> 
<span class="menu-text">Project 4</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Project_5.html" aria-current="page"> 
<span class="menu-text">Project 5</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#analysis-of-contraception-data-from-the-package-mlmrev-using-generalized-mixed-models" id="toc-analysis-of-contraception-data-from-the-package-mlmrev-using-generalized-mixed-models" class="nav-link active" data-scroll-target="#analysis-of-contraception-data-from-the-package-mlmrev-using-generalized-mixed-models"><strong>Analysis of Contraception Data from the Package mlmRev Using Generalized Mixed Models</strong></a>
  <ul class="collapse">
  <li><a href="#data-visualization" id="toc-data-visualization" class="nav-link" data-scroll-target="#data-visualization">Data Visualization</a></li>
  <li><a href="#modeling-strategy" id="toc-modeling-strategy" class="nav-link" data-scroll-target="#modeling-strategy">Modeling Strategy</a>
  <ul class="collapse">
  <li><a href="#fixed-effects" id="toc-fixed-effects" class="nav-link" data-scroll-target="#fixed-effects">Fixed Effects</a></li>
  </ul></li>
  <li><a href="#model-fit" id="toc-model-fit" class="nav-link" data-scroll-target="#model-fit"><strong>Model Fit</strong></a></li>
  <li><a href="#diagnostics" id="toc-diagnostics" class="nav-link" data-scroll-target="#diagnostics"><strong>Diagnostics</strong></a></li>
  <li><a href="#coefficient-plots-and-effects-plots" id="toc-coefficient-plots-and-effects-plots" class="nav-link" data-scroll-target="#coefficient-plots-and-effects-plots">Coefficient Plots and Effects Plots</a></li>
  <li><a href="#package-comparisson" id="toc-package-comparisson" class="nav-link" data-scroll-target="#package-comparisson">Package Comparisson</a></li>
  </ul></li>
  <li><a href="#plot-of-the-random-effect-of-urban-for-each-district" id="toc-plot-of-the-random-effect-of-urban-for-each-district" class="nav-link" data-scroll-target="#plot-of-the-random-effect-of-urban-for-each-district">Plot of the Random Effect of Urban for Each District</a>
  <ul class="collapse">
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Project_5.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Project 5</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Konstantinos Banos </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 20, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div style="page-break-after: always;"></div>
<section id="analysis-of-contraception-data-from-the-package-mlmrev-using-generalized-mixed-models" class="level1">
<h1><strong>Analysis of Contraception Data from the Package mlmRev Using Generalized Mixed Models</strong></h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load data</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">data</span>(<span class="st">"Contraception"</span>, <span class="at">package =</span> <span class="st">"mlmRev"</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Creation of a new column called "u"</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>Contraception <span class="ot">&lt;-</span> <span class="fu">transform</span>(</span>
<span id="cb1-6"><a href="#cb1-6"></a>  Contraception,</span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="at">use_num =</span> <span class="fu">as.numeric</span>(use)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="at">urban =</span> <span class="fu">factor</span>(Contraception<span class="sc">$</span>urban, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"N"</span>, <span class="st">"Y"</span>))</span>
<span id="cb1-9"><a href="#cb1-9"></a>  )</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">head</span>(Contraception)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  woman district use livch      age urban use_num
1     1        1   N    3+  18.4400     Y       0
2     2        1   N     0  -5.5599     Y       0
3     3        1   N     2   1.4400     Y       0
4     4        1   N    3+   8.4400     Y       0
5     5        1   N     0 -13.5590     Y       0
6     6        1   N     0 -11.5600     Y       0</code></pre>
</div>
</div>
<p>This study investigates the hierarchical effects and determinants of contraceptive use in urban and rural Bangladesh, leveraging data from the 1989 Bangladesh Fertility Survey (BFS). A total of 11,905 ever-married women of reproductive age (10–49 years) were surveyed across urban and rural settings. The primary objective was to explore the demographic, socio-economic, cultural, and decision-making factors influencing contraceptive use, while accounting for the nested structure of the data through multilevel logistic regression modeling. Women were grouped within census blocks, which were further nested within regions, enabling the study to examine both individual-level and contextual determinants.</p>
<p>Key findings from the original study highlight significant insights into contraceptive use patterns. Factors positively associated with contraceptive use included higher parity, women’s education, female independence scores, and joint family planning decisions, underscoring the importance of education and autonomy in reproductive health choices. Conversely, child mortality exhibited a significant negative influence, as experiences of child loss deterred contraceptive adoption. Urban-rural differences revealed notable disparities: urban women reported higher education, independence, and contraceptive use, while rural women experienced higher child mortality and lower autonomy and educational attainment. Hierarchical variation at the block level emphasized localized disparities in access to family planning resources and socio-cultural influences, particularly in remote rural areas. Interestingly, while religion and women’s work experience were found to have limited influence overall, younger rural women showed a positive association between work status and contraceptive use.</p>
<p>The current dataset, while a subset of the original BFS data, offers an opportunity to revisit these questions and refine our understanding of contraceptive use dynamics in Bangladesh. By analyzing the data through a similar multilevel framework, we aim to replicate and extend the findings, examining whether the determinants and hierarchical variations observed in the original study persist. This analysis will help to validate previous conclusions and provide updated insights into the interplay of socio-economic, demographic, and cultural factors shaping contraceptive use across urban and rural settings (in a much shorter scale as we have much less data and variables).</p>
<section id="data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="data-visualization">Data Visualization</h2>
<p>Before specifying the modeling process, it is essential to visually explore the data to gain valuable insights into its structure, relationships, and patterns. Graphical representations allow for an intuitive understanding of the data’s key features, enabling informed decisions about the modeling strategy, potential transformations, and variable selection. This step provides a foundation for identifying trends, outliers, and potential interactions, which are crucial for constructing effective and interpretable models.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">ggplot</span>(Contraception, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> use_num)) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="at">height =</span> <span class="fl">0.05</span>, <span class="at">width =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">"lightblue"</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  ) <span class="sc">+</span> </span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">span =</span> <span class="fl">0.8</span>, <span class="at">formula =</span> <span class="st">'y~x'</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>  ) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb3-9"><a href="#cb3-9"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb3-10"><a href="#cb3-10"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Not Using"</span>, <span class="st">"Using"</span>)</span>
<span id="cb3-11"><a href="#cb3-11"></a>  ) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-13"><a href="#cb3-13"></a>    <span class="at">title =</span> <span class="st">"Contraception Usage vs Age"</span>,</span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="at">subtitle =</span> <span class="st">"Smoothed trend with jittered raw data points"</span>,</span>
<span id="cb3-15"><a href="#cb3-15"></a>    <span class="at">x =</span> <span class="st">"Age (in years)"</span>, </span>
<span id="cb3-16"><a href="#cb3-16"></a>    <span class="at">y =</span> <span class="st">"Contraception Usage"</span></span>
<span id="cb3-17"><a href="#cb3-17"></a>  ) <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>  <span class="fu">theme</span>(</span>
<span id="cb3-20"><a href="#cb3-20"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb3-21"><a href="#cb3-21"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb3-22"><a href="#cb3-22"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb3-23"><a href="#cb3-23"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>The relationship between age and contraception usage exhibits a clear <strong>non-linear trend</strong>, as shown in the graph. Contraception usage increases with age during younger adulthood, peaks at mid-range ages, and then declines in older age, forming a curved pattern. This suggests that individuals in middle age are more likely to use contraception compared to younger or older individuals. The jittered raw data points highlight the binary nature of the response (“Using” vs.&nbsp;“Not Using”), with more individuals in the “Not Using” category at both age extremes. The shaded confidence interval around the smoothed trend line reflects greater variability at the younger and older ends of the age spectrum, reinforcing the need for targeted analysis when considering age-related contraception usage trends.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">ggplot</span>(Contraception, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> use_num, <span class="at">color =</span> urban)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.05</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> livch, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">livch =</span> <span class="cf">function</span>(x) <span class="fu">paste</span>(<span class="st">"Living Children:"</span>, x))) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"steelblue"</span>)) <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>  <span class="fu">theme</span>(</span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-10"><a href="#cb4-10"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>  ) <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>  <span class="fu">labs</span>(</span>
<span id="cb4-14"><a href="#cb4-14"></a>    <span class="at">title =</span> <span class="st">"Contraception Usage by Age and Urbanization"</span>,</span>
<span id="cb4-15"><a href="#cb4-15"></a>    <span class="at">x =</span> <span class="st">"Age (Years)"</span>,</span>
<span id="cb4-16"><a href="#cb4-16"></a>    <span class="at">y =</span> <span class="st">"Contraception Use (Binary)"</span>,</span>
<span id="cb4-17"><a href="#cb4-17"></a>    <span class="at">color =</span> <span class="st">"Urbanization"</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>The relationship between age and contraception usage shows a distinct <strong>non-linear trend</strong>, moderated by both the number of living children and urbanization. In all panels, contraception usage increases with age, peaks, and declines in later years, forming a curved pattern. This trend is more pronounced in individuals with <strong>more living children</strong>, particularly those with <strong>2 or 3+ children</strong>, where usage reaches higher probabilities. Urban residents (“Y”) consistently report higher contraception usage compared to their rural counterparts (“N”) across all age groups, though the gap is most noticeable among those with fewer children. The relationship remains weakest and flattest for individuals with no children, highlighting how both urbanization and family size influence the likelihood of contraception use over the life course.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Assuming Contraception is a data frame and livch is a numeric variable.</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">ggplot</span>(Contraception, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(livch))) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(livch)), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"steelblue"</span>, <span class="st">"lightblue"</span>, <span class="st">"skyblue"</span>, <span class="st">"lightsteelblue"</span>, <span class="st">"deepskyblue"</span>)) <span class="sc">+</span>  <span class="co"># Customize colors close to steelblue and lightblue</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="at">title =</span> <span class="st">"Number of Living Children by Contraception Usage"</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="at">x =</span> <span class="st">"Number of Living Children"</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>    <span class="at">y =</span> <span class="st">"Count of Individuals"</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>    <span class="at">fill =</span> <span class="st">"Living Children"</span>  <span class="co"># Customize legend title</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>  ) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>  <span class="fu">theme</span>(</span>
<span id="cb5-13"><a href="#cb5-13"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),  <span class="co"># Rotate x-axis labels if needed</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb5-15"><a href="#cb5-15"></a>  ) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">'count'</span>, <span class="fu">aes</span>(<span class="at">label =</span> ..count..), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>)  <span class="co"># Display count on top of bars</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>The bar chart illustrates the distribution of individuals based on the number of living children, categorized into four groups: 0, 1, 2, and 3 or more children. The data indicates that the majority of individuals fall within the “3+” category, comprising 743 individuals, followed by the “0” group with 530 individuals. The categories “1” and “2” are comparatively smaller, containing 356 and 305 individuals, respectively. The counts for each group are clearly labeled, and the chart uses a gradient of blues to differentiate the categories, with darker shades representing fewer children. The visualization effectively highlights the prevalence of individuals with three or more living children in this dataset.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>create_bar_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_var, x_label) {</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> .data[[x_var]], <span class="at">fill =</span> <span class="fu">factor</span>(use_num))) <span class="sc">+</span> </span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="fu">labs</span>(</span>
<span id="cb6-5"><a href="#cb6-5"></a>      <span class="at">x =</span> x_label, </span>
<span id="cb6-6"><a href="#cb6-6"></a>      <span class="at">y =</span> <span class="st">"Proportion of Contraceptive Use"</span>, </span>
<span id="cb6-7"><a href="#cb6-7"></a>      <span class="at">fill =</span> <span class="st">"Contraceptive Use"</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>    ) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>    <span class="fu">scale_fill_manual</span>(</span>
<span id="cb6-10"><a href="#cb6-10"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>),</span>
<span id="cb6-11"><a href="#cb6-11"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>)</span>
<span id="cb6-12"><a href="#cb6-12"></a>    ) <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span> <span class="co"># Larger base size for better readability</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="fu">theme</span>(</span>
<span id="cb6-15"><a href="#cb6-15"></a>      <span class="at">legend.position =</span> <span class="st">"top"</span>, </span>
<span id="cb6-16"><a href="#cb6-16"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>), <span class="co"># Rotate x-axis labels if needed</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),  <span class="co"># Bigger and bolder x-title</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),  <span class="co"># Bigger and bolder y-title</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb6-20"><a href="#cb6-20"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb6-21"><a href="#cb6-21"></a>    ) <span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22"></a>    <span class="fu">geom_text</span>(</span>
<span id="cb6-23"><a href="#cb6-23"></a>      <span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(..count.. <span class="sc">/</span> <span class="fu">sum</span>(..count..))),</span>
<span id="cb6-24"><a href="#cb6-24"></a>      <span class="at">stat =</span> <span class="st">"count"</span>,</span>
<span id="cb6-25"><a href="#cb6-25"></a>      <span class="at">position =</span> <span class="fu">position_fill</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="co"># Position the text in the middle of the bars</span></span>
<span id="cb6-26"><a href="#cb6-26"></a>      <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>  <span class="co"># White text for contrast</span></span>
<span id="cb6-27"><a href="#cb6-27"></a>    )</span>
<span id="cb6-28"><a href="#cb6-28"></a>}</span>
<span id="cb6-29"><a href="#cb6-29"></a></span>
<span id="cb6-30"><a href="#cb6-30"></a><span class="do">## CONTRACEPTION  VS LIVING CHILDREN BAR PLOT</span></span>
<span id="cb6-31"><a href="#cb6-31"></a><span class="fu">create_bar_plot</span>(Contraception, <span class="st">"livch"</span>, <span class="st">"Number of Living Children"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>The plot is a stacked bar chart illustrating the proportion of contraceptive use (Yes vs.&nbsp;No) across categories of the number of living children (0, 1, 2, and 3+). Contraceptive use increases notably as the number of living children rises. For instance, in the 3+ children category, approximately 16.29% of individuals report contraceptive use, compared to 6.88% in the childless group. The trend indicates a positive association between the number of living children and the likelihood of contraceptive use, suggesting that family size may influence contraceptive decisions.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>create_box_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">boxplot</span>(age <span class="sc">~</span> use_num, </span>
<span id="cb7-3"><a href="#cb7-3"></a>          <span class="at">data =</span> data, </span>
<span id="cb7-4"><a href="#cb7-4"></a>          <span class="at">xlab =</span> <span class="st">"Contraceptive Use (0 = Non-Users, 1 = Users)"</span>, </span>
<span id="cb7-5"><a href="#cb7-5"></a>          <span class="at">ylab =</span> <span class="st">"Age (Centered)"</span>, </span>
<span id="cb7-6"><a href="#cb7-6"></a>          <span class="at">main =</span> <span class="st">"Age Distribution by Contraceptive Use"</span>, </span>
<span id="cb7-7"><a href="#cb7-7"></a>          <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"steelblue"</span>), </span>
<span id="cb7-8"><a href="#cb7-8"></a>          <span class="at">border =</span> <span class="st">"black"</span>, </span>
<span id="cb7-9"><a href="#cb7-9"></a>          <span class="at">notch =</span> <span class="cn">TRUE</span>, </span>
<span id="cb7-10"><a href="#cb7-10"></a>          <span class="at">outline =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-11"><a href="#cb7-11"></a>          <span class="at">horizontal =</span> <span class="cn">FALSE</span>, </span>
<span id="cb7-12"><a href="#cb7-12"></a>          <span class="at">las =</span> <span class="dv">1</span>,  <span class="co"># Horizontal x-axis labels</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>          <span class="at">cex.main =</span> <span class="fl">1.5</span>,  <span class="co"># Larger title</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>          <span class="at">cex.lab =</span> <span class="fl">1.2</span>,   <span class="co"># Larger axis labels</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>          <span class="at">cex.axis =</span> <span class="fl">1.1</span>,  <span class="co"># Larger axis ticks</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>          <span class="at">boxwex =</span> <span class="fl">0.4</span>,    <span class="co"># Adjust box width</span></span>
<span id="cb7-17"><a href="#cb7-17"></a>          <span class="at">whisklty =</span> <span class="dv">1</span>,    <span class="co"># Solid whiskers</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>          <span class="at">whiskcol =</span> <span class="st">"black"</span>)  <span class="co"># Black whiskers</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>  </span>
<span id="cb7-20"><a href="#cb7-20"></a>  <span class="co"># Add median line for clarity</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">median</span>(data<span class="sc">$</span>age), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)  <span class="co"># Red dashed line for median</span></span>
<span id="cb7-22"><a href="#cb7-22"></a>  </span>
<span id="cb7-23"><a href="#cb7-23"></a>  <span class="co"># Add mean points for comparison</span></span>
<span id="cb7-24"><a href="#cb7-24"></a>  <span class="fu">points</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="fu">tapply</span>(data<span class="sc">$</span>age, data<span class="sc">$</span>use_num, mean), <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"black"</span>)  <span class="co"># Mean points</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>  </span>
<span id="cb7-26"><a href="#cb7-26"></a>  <span class="co"># Add grid for easier comparison</span></span>
<span id="cb7-27"><a href="#cb7-27"></a>  <span class="fu">grid</span>(<span class="at">nx =</span> <span class="cn">NULL</span>, <span class="at">ny =</span> <span class="cn">NULL</span>, <span class="at">col =</span> <span class="st">"gray"</span>, <span class="at">lty =</span> <span class="st">"dotted"</span>)</span>
<span id="cb7-28"><a href="#cb7-28"></a>}</span>
<span id="cb7-29"><a href="#cb7-29"></a></span>
<span id="cb7-30"><a href="#cb7-30"></a><span class="co"># Create the box plot for age distribution</span></span>
<span id="cb7-31"><a href="#cb7-31"></a><span class="fu">create_box_plot</span>(Contraception)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>The first plot presents a boxplot comparing the centered age distribution between contraceptive users (coded as 1) and non-users (coded as 0). Both groups have similar median ages (approximately centered at zero), with a slight variation in spread. Non-users exhibit a broader interquartile range and greater variability, whereas contraceptive users show a more compact age range. The black dots indicate mean values, which are nearly identical for both groups. This suggests that age, while centered here, does not show a significant difference in distribution between the two categories of contraceptive use, except the heavier tails for non-users.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>Contraception <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">count</span>(district) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(district, <span class="sc">-</span>n), <span class="at">y =</span> n, <span class="at">fill =</span> n)) <span class="sc">+</span>  <span class="co"># Map 'n' to 'fill' for color gradient</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"lightblue"</span>, <span class="at">high =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span>  <span class="co"># Gradient from light to dark blue</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">12</span>),  <span class="co"># Larger text for better readability</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb8-10"><a href="#cb8-10"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb8-11"><a href="#cb8-11"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">18</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb8-12"><a href="#cb8-12"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,  <span class="co"># Hide the legend</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">10</span>)  <span class="co"># Add margin for better spacing</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>  ) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-16"><a href="#cb8-16"></a>    <span class="at">title =</span> <span class="st">"Count of Contraception Usage by District"</span>,</span>
<span id="cb8-17"><a href="#cb8-17"></a>    <span class="at">x =</span> <span class="st">"District"</span>,</span>
<span id="cb8-18"><a href="#cb8-18"></a>    <span class="at">y =</span> <span class="st">"Count"</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>The bar chart depicts the count of contraception usage across various districts, arranged in descending order of usage frequency. The data reveals significant variability among districts, with the highest count exceeding 120 and gradually declining across the districts. The distribution demonstrates a few districts with notably high counts of contraception usage, while the majority show moderate to low levels. The chart employs a gradient of blue shades to represent the counts, enhancing the visual differentiation between districts. This visualization highlights the disparities in contraception usage across districts, suggesting potential regional differences in adoption or access.</p>
</section>
<section id="modeling-strategy" class="level2">
<h2 class="anchored" data-anchor-id="modeling-strategy">Modeling Strategy</h2>
<p>According to Harrell’s guidelines <span class="citation" data-cites="harrell">[@harrell]</span> and given the current sample size, we are able to include the full number of predictor variables in the model. My approach involves a <strong>Generalized Linear Mixed Model (GLMM)</strong> with a <strong>binomial family</strong> and a <strong>logit link function (I decided to use logit link as it is easily interpretable)</strong>. This model is appropriate given the binary nature of the response variable, <code>use_num</code>, essentially the proposed model is a <strong>logistic regression model</strong> with random effects for the variable “district” with the intercept and “urban” varying across each “district.”</p>
<p>The conditional distribution for <code>use_num</code> given the covariates and random effects is:</p>
<p><span class="math display">\[
Y_i \mid \mathbf{x}_i, u_i \sim \text{Bernoulli}\left(\frac{1}{1 + \exp(-\eta_i)}\right)
\]</span></p>
<p>where <span class="math inline">\(\eta_i\)</span> is the linear predictor for individual <span class="math inline">\(i\)</span>, incorporating both the fixed effects and the random effects for the district.</p>
<section id="fixed-effects" class="level3">
<h3 class="anchored" data-anchor-id="fixed-effects">Fixed Effects</h3>
<ol type="1">
<li><p><strong>Centered Age of Women (<code>age</code>):</strong> The first predictor is the centered age of women (using a spline for capturing the non-linear relationship of the variable <code>age</code>). It is hypothesized that the relationship between age and contraception use follows an inverted U-shape, with both younger and older women using contraception less frequently than those in middle age. This makes age an important predictor in the model.</p></li>
<li><p><strong>Number of Living Children (<code>livch</code>):</strong> The second predictor is the number of living children. It is expected that as individuals establish stable partnerships and have children, the need for contraception may decrease. Therefore, the number of children is anticipated to influence contraception usage, justifying its inclusion as a predictor in the model.</p></li>
<li><p><strong>Type of Residence (<code>urban</code>):</strong> The third predictor is the type of residence, which is categorized as either urban or rural. Contraception use is often linked to socio-economic factors, and urban areas tend to be wealthier and offer better educational opportunities. Higher education levels are generally associated with increased contraception use<span class="citation" data-cites="CanadianContraceptionConsensusChapter1ContraceptioninCanada">[@CanadianContraceptionConsensusChapter1ContraceptioninCanada]</span>, suggesting that the type of residence could significantly impact contraception behavior.</p></li>
</ol>
<p>In this analysis, the maximal model for our problem includes random intercepts and random slopes for the urban variable, which varies across 60 districts (groups). If convergence issues or singularity problems arise, a stepwise reduction of the model will be employed, initially by removing the random slope for each urban variable. Further model modifications will be discussed if necessary based on subsequent challenges.</p>
<p>For the integration of the random effects, both the Laplace approximation and the Penalized Quasi-Likelihood (PQL) approximation will be utilized. Given that the random effects in this model are not particularly complex, both methods are expected to provide reliable, fast, and accurate results. The PQL approximation, in particular, is known for offering relatively better approximations for model withm complex random effect when the laplace approximation method struggles (but it is a bit slower), and both techniques will be applied for completeness.</p>
<p>To implement the model, I will use three packages: <strong>lme4</strong>, <strong>MASS</strong>, and <strong>brms</strong>. The <strong>lme4</strong> package provides the <code>glmer()</code> function, a frequentist approach for fitting generalized linear mixed models (GLMMs). It uses the Laplace approximation, which is computationally efficient and reliable for fitting models with complex random effects structures. The advantage of using <strong>lme4</strong> lies in its ability to handle large datasets with high dimensionality and its robustness in estimating fixed and random effects, making it an excellent choice for models with multiple predictors and random effects structures. The <strong>MASS</strong> package provides the <code>glmmPQL()</code> function, which is a frequentist method based on the penalized quasi-likelihood (PQL) approximation. This approach is suitable for models with non-Gaussian responses and is particularly effective when random effects have complex structures. Although less commonly used today, it remains a viable option when alternative methods, such as Laplace approximation, struggle with convergence or performance, especially in smaller datasets or when there are numerous levels of grouping factors.</p>
<p>The <strong>brms</strong> package is a Bayesian framework that fits GLMMs using Hamiltonian Monte Carlo (HMC) through Stan. This package is chosen for its flexibility in specifying complex prior distributions and its ability to provide full posterior distributions of model parameters, allowing for more nuanced inferences compared to frequentist methods. <strong>brms</strong> allows for detailed prior specification, which is important for this model, as I plan to use a combination of flat, uninformative priors for fixed effects (b), such as b (default) for livch1, livch2, livch3P, nsagedfEQ21, nsagedfEQ22, and urbanY. For the intercept, I will use a <strong>half-student-t(3, 0, 2.5)</strong> prior, as it offers heavier tails, which is beneficial in accommodating outliers or influential data points without overly constraining the model. For the random effects, I will use a <strong>half-Cauchy(0, 2.5)</strong> prior for the standard deviations (sd) of random effects, including district and intercept district, as well as the <strong>LKJ(1)</strong> prior for the correlation structure of the random effects. The <strong>half-Cauchy(0, 2.5)</strong> prior is a common choice for random effect standard deviations in hierarchical models, as it allows for flexibility while avoiding excessive shrinkage of the random effects variance. The <strong>LKJ(1)</strong> prior is used to model the correlation structure among the random effects and encourages weak correlations among random effects, which is a sensible assumption in many applied settings.</p>
<p>Together, these three packages provide a comprehensive suite for fitting GLMMs from both frequentist and Bayesian perspectives. <strong>lme4</strong> offers a robust frequentist approach, <strong>MASS</strong> provides an alternative for complex random effects structures, and <strong>brms</strong> offers Bayesian modeling with flexible prior specifications. This combination of methods ensures a thorough comparison between frequentist and Bayesian approaches, each of which has distinct advantages depending on the nature of the data and the model.</p>
</section>
</section>
<section id="model-fit" class="level2">
<h2 class="anchored" data-anchor-id="model-fit"><strong>Model Fit</strong></h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="do">## Model 1: glmmTMB</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>model_glmer <span class="ot">&lt;-</span> <span class="fu">glmer</span>(use_num <span class="sc">~</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>                         <span class="fu">ns</span>(age,<span class="at">df=</span><span class="dv">2</span>) <span class="sc">+</span> livch <span class="sc">+</span> urban <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>urban<span class="sc">|</span>district), </span>
<span id="cb9-4"><a href="#cb9-4"></a>                         <span class="at">data =</span> Contraception, </span>
<span id="cb9-5"><a href="#cb9-5"></a>                         <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co"># Model 2: glmmPQL</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>glmmPQL_model <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">glmmPQL</span>(use_num <span class="sc">~</span> </span>
<span id="cb9-10"><a href="#cb9-10"></a>                               <span class="fu">ns</span>(age,<span class="at">df=</span><span class="dv">2</span>) <span class="sc">+</span> livch <span class="sc">+</span> urban, <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>                               urban<span class="sc">|</span>district,<span class="at">family =</span> binomial, <span class="at">data =</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>                               Contraception)</span>
<span id="cb9-13"><a href="#cb9-13"></a></span>
<span id="cb9-14"><a href="#cb9-14"></a></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co"># Model 3: Bayesian Model</span></span>
<span id="cb9-16"><a href="#cb9-16"></a></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="co"># Define half-Cauchy priors</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-19"><a href="#cb9-19"></a>  <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">2.5</span>), <span class="at">class =</span> <span class="st">"sd"</span>),            <span class="co"># Half-Cauchy for random effect SDs</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>  <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">2.5</span>), <span class="at">class =</span> <span class="st">"sd"</span>, <span class="at">group =</span> <span class="st">"district"</span>),  <span class="co"># Specific to district random effects</span></span>
<span id="cb9-21"><a href="#cb9-21"></a>  <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">2.5</span>), <span class="at">class =</span> <span class="st">"sd"</span>, <span class="at">coef =</span> <span class="st">"urbanY"</span>, <span class="at">group =</span> <span class="st">"district"</span>) <span class="co"># Specific slope</span></span>
<span id="cb9-22"><a href="#cb9-22"></a>)</span>
<span id="cb9-23"><a href="#cb9-23"></a></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="co"># Update the model with new priors</span></span>
<span id="cb9-25"><a href="#cb9-25"></a>model_brms <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb9-26"><a href="#cb9-26"></a>  use_num <span class="sc">~</span> <span class="fu">ns</span>(age, <span class="at">df =</span> <span class="dv">2</span>) <span class="sc">+</span> livch <span class="sc">+</span> urban <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> urban <span class="sc">|</span> district),</span>
<span id="cb9-27"><a href="#cb9-27"></a>  <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb9-28"><a href="#cb9-28"></a>  <span class="at">data =</span> Contraception,</span>
<span id="cb9-29"><a href="#cb9-29"></a>  <span class="at">prior =</span> priors</span>
<span id="cb9-30"><a href="#cb9-30"></a>)</span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="co"># prior_summary(model_brms)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">summary</span>(model_glmer)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: binomial  ( logit )
Formula: use_num ~ ns(age, df = 2) + livch + urban + (1 + urban | district)
   Data: Contraception

      AIC       BIC    logLik -2*log(L)  df.resid 
   2381.6    2437.3   -1180.8    2361.6      1924 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-1.9469 -0.7436 -0.4449  0.9012  3.0816 

Random effects:
 Groups   Name        Variance Std.Dev. Corr 
 district (Intercept) 0.3874   0.6224        
          urbanY      0.5469   0.7395   -0.79
Number of obs: 1934, groups:  district, 60

Fixed effects:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       -1.8991     0.1808 -10.503  &lt; 2e-16 ***
ns(age, df = 2)1   1.0942     0.4392   2.491   0.0127 *  
ns(age, df = 2)2  -1.2294     0.2411  -5.099 3.41e-07 ***
livch1             0.8314     0.1654   5.026 5.00e-07 ***
livch2             0.9063     0.1896   4.781 1.75e-06 ***
livch3+            0.9338     0.1903   4.907 9.25e-07 ***
urbanY             0.7756     0.1643   4.720 2.36e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) n(,d=2)1 n(,d=2)2 livch1 livch2 lvch3+
ns(g,df=2)1 -0.567                                       
ns(g,df=2)2 -0.040  0.330                                
livch1      -0.217 -0.312   -0.065                       
livch2      -0.081 -0.493   -0.162    0.526              
livch3+     -0.026 -0.655   -0.449    0.565  0.651       
urbanY      -0.384 -0.045   -0.029    0.051  0.076  0.076</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">summary</span>(glmmPQL_model)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed-effects model fit by maximum likelihood
  Data: Contraception 
  AIC BIC logLik
   NA  NA     NA

Random effects:
 Formula: ~1 + urban | district
 Structure: General positive-definite, Log-Cholesky parametrization
            StdDev    Corr  
(Intercept) 0.6127317 (Intr)
urbanY      0.7392394 -0.788
Residual    0.9755972       

Variance function:
 Structure: fixed weights
 Formula: ~invwt 
Fixed effects:  use_num ~ ns(age, df = 2) + livch + urban 
                      Value Std.Error   DF    t-value p-value
(Intercept)      -1.8499396 0.1745571 1868 -10.597905  0.0000
ns(age, df = 2)1  1.0675016 0.4251999 1868   2.510588  0.0121
ns(age, df = 2)2 -1.1977196 0.2326712 1868  -5.147693  0.0000
livch1            0.8124300 0.1598835 1868   5.081386  0.0000
livch2            0.8843755 0.1832614 1868   4.825760  0.0000
livch3+           0.9124638 0.1835004 1868   4.972544  0.0000
urbanY            0.7529924 0.1593175 1868   4.726363  0.0000
 Correlation: 
                 (Intr) n(,d=2)1 n(,d=2)2 livch1 livch2 lvch3+
ns(age, df = 2)1 -0.569                                       
ns(age, df = 2)2 -0.050  0.332                                
livch1           -0.215 -0.312   -0.063                       
livch2           -0.077 -0.493   -0.159    0.527              
livch3+          -0.017 -0.658   -0.445    0.565  0.651       
urbanY           -0.393 -0.042   -0.031    0.047  0.077  0.075

Standardized Within-Group Residuals:
       Min         Q1        Med         Q3        Max 
-1.9857276 -0.7643117 -0.4595243  0.9260949  3.1084571 

Number of Observations: 1934
Number of Groups: 60 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">summary</span>(model_brms)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: bernoulli 
  Links: mu = logit 
Formula: use_num ~ ns(age, df = 2) + livch + urban + (1 + urban | district) 
   Data: Contraception (Number of observations: 1934) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Multilevel Hyperparameters:
~district (Number of levels: 60) 
                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(Intercept)             0.64      0.10     0.45     0.87 1.01     1240
sd(urbanY)                0.76      0.22     0.35     1.20 1.01      876
cor(Intercept,urbanY)    -0.70      0.16    -0.92    -0.30 1.00     1715
                      Tail_ESS
sd(Intercept)             1946
sd(urbanY)                1046
cor(Intercept,urbanY)     2127

Regression Coefficients:
            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept      -1.91      0.18    -2.26    -1.55 1.00     3049     3296
nsagedfEQ21     1.10      0.44     0.25     1.96 1.00     2761     3194
nsagedfEQ22    -1.24      0.25    -1.73    -0.76 1.00     3963     3269
livch1          0.84      0.16     0.52     1.15 1.00     3235     3102
livch2          0.91      0.19     0.55     1.29 1.00     2462     2820
livch3P         0.94      0.19     0.58     1.31 1.00     1955     2423
urbanY          0.78      0.17     0.44     1.12 1.00     2257     2781

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>After fitting the models using different packages, we did not encounter any convergence or singularity issues. Consequently, we will proceed with the analysis based on the initial model. Should any issues arise during the diagnostic checks, we will consider making necessary adjustments to the model.</p>
</section>
<section id="diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics"><strong>Diagnostics</strong></h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>residuals_dharma <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(model_glmer)</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co"># Plot the residuals</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="fu">plot</span>(residuals_dharma)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(model_glmer, <span class="at">panel =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>The diagnostic plots assess the fit and assumptions of the model. The first set of plots, generated using DHARMa, shows that residual diagnostics do not indicate significant issues. The QQ plot demonstrates that observed residuals align well with expectations under the fitted model, as evidenced by the nonsignificant Kolmogorov-Smirnov test (p = 0.87215). Furthermore, dispersion and outlier tests also fail to detect deviations, suggesting no overdispersion or extreme values affecting the model fit. The residual vs.&nbsp;predicted plot confirms that residuals are evenly distributed across predicted values without systematic patterns, indicating an appropriate functional form for the predictors.</p>
<p>The second set of diagnostics provides further insights. The posterior predictive check shows observed and model-predicted distributions closely matching, supporting the adequacy of the model. Binned residuals mostly fall within error bounds, except for minor deviations, which may warrant attention. The VIF values for predictors are well below 5, indicating no concerning multicollinearity. Influential observations appear within acceptable ranges on the leverage plot, and the residual uniformity aligns with theoretical expectations. Random effects also display normality, as indicated by quantile plots, reinforcing the validity of the random structure. Together, these diagnostics suggest the model is well-specified, with only minor areas for potential refinement.</p>
<p>Hence, there is no need for any changes to our model, and we could say that it is adequate for the above problem.</p>
</section>
<section id="coefficient-plots-and-effects-plots" class="level2">
<h2 class="anchored" data-anchor-id="coefficient-plots-and-effects-plots">Coefficient Plots and Effects Plots</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>model_glmer_scaled <span class="ot">&lt;-</span> <span class="fu">glmer</span>(use_num <span class="sc">~</span> </span>
<span id="cb18-2"><a href="#cb18-2"></a>                         <span class="fu">ns</span>(<span class="fu">scale</span>(age),<span class="at">df=</span><span class="dv">2</span>) <span class="sc">+</span> livch <span class="sc">+</span> urban <span class="sc">+</span> (<span class="dv">1</span><span class="sc">+</span>urban<span class="sc">|</span>district), </span>
<span id="cb18-3"><a href="#cb18-3"></a>                         <span class="at">data =</span> Contraception, </span>
<span id="cb18-4"><a href="#cb18-4"></a>                         <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a>sjPlot<span class="sc">::</span><span class="fu">plot_model</span>(model_glmer_scaled, <span class="at">type =</span> <span class="st">"est"</span>, <span class="at">show.values =</span> <span class="cn">TRUE</span>, <span class="at">show.p =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-7"><a href="#cb18-7"></a>                   <span class="at">title =</span> <span class="st">"Coefficient Plot for Mixed-Effects Logistic Regression using lme4"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>The coefficient plot illustrates the odds ratios for predictors in a mixed-effects logistic regression model. Each point represents the odds ratio for a predictor, with horizontal lines denoting the corresponding 95% confidence intervals. Significant predictors are marked with asterisks indicating their level of significance (*p &lt; 0.05, **p &lt; 0.01, ***p &lt; 0.001). The “scale” variable has two components: one showing a significant positive effect (OR = 2.99, p &lt; 0.05) and the other a significant negative effect (OR = 0.29, p &lt; 0.001). The categorical variable “livch” exhibits increasing odds ratios across levels, with the highest level (3+) having an OR of 2.54 (p &lt; 0.001). The variable “urban [Y]” is also significantly associated with the outcome (OR = 2.17, p &lt; 0.001), indicating that urban residency increases the odds of the modeled outcome. These results demonstrate the importance of these predictors in explaining variability in the response variable.<br>
</p>
<p>Bellow, I will also provide coefficient plots of the other methods, but the interpretation remains the same (for completeness).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>glmmPQL_model_scaled <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">glmmPQL</span>(use_num <span class="sc">~</span> </span>
<span id="cb19-2"><a href="#cb19-2"></a>                               <span class="fu">ns</span>(<span class="fu">scale</span>(age),<span class="at">df=</span><span class="dv">2</span>) <span class="sc">+</span> livch <span class="sc">+</span> urban, <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span><span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>                               urban<span class="sc">|</span>district,<span class="at">family =</span> binomial, <span class="at">data =</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>                               Contraception)</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a>sjPlot<span class="sc">::</span><span class="fu">plot_model</span>(glmmPQL_model_scaled, <span class="at">type =</span> <span class="st">"est"</span>, <span class="at">show.values =</span> <span class="cn">TRUE</span>, <span class="at">show.p =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-7"><a href="#cb19-7"></a>                   <span class="at">title =</span> <span class="st">"Coefficient Plot for Mixed-Effects Logistic Regression using MASS (PQL)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>and for the Bayesian model:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>sjPlot<span class="sc">::</span><span class="fu">plot_model</span>(glmmPQL_model_scaled, <span class="at">type =</span> <span class="st">"est"</span>, <span class="at">show.values =</span> <span class="cn">TRUE</span>, <span class="at">show.p =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-2"><a href="#cb20-2"></a>                   <span class="at">title =</span> <span class="st">"Coefficient Plot for Mixed-Effects Logistic Regression using brms"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>Now, for the effects plots I will only provide the effect plot from the model using lme4, as they are identical.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Plot the effects of the model</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">plot</span>(<span class="fu">allEffects</span>(model_glmer), <span class="at">main =</span> <span class="st">"Effects of Predictors on Contraception Use"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>The set of plots illustrates the effects of three predictors—age, number of living children (livch), and urban residency (urban)—on contraception use, based on model estimates. The first plot shows a non-linear relationship between age and contraception use, with usage peaking around the middle age range and decreasing at both younger and older ages. The shaded area represents the 95% confidence interval for the predicted values. The second plot highlights a positive association between the number of living children and contraception use, where usage increases significantly from 0 to 3+ children, stabilizing for the highest category. The third plot compares contraception use between urban and non-urban residents, indicating higher usage among urban residents, with error bars denoting the confidence intervals. These findings suggest that all three predictors—age, livch, and urban—significantly influence contraception use patterns.</p>
</section>
<section id="package-comparisson" class="level2">
<h2 class="anchored" data-anchor-id="package-comparisson">Package Comparisson</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>models_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="at">model_glmer =</span> model_glmer,</span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="at">glmmPQL_model =</span> glmmPQL_model,</span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="at">model_brms =</span> model_brms</span>
<span id="cb22-5"><a href="#cb22-5"></a>)</span>
<span id="cb22-6"><a href="#cb22-6"></a></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="co"># Extract and arrange fixed effect coefficients for comparison</span></span>
<span id="cb22-8"><a href="#cb22-8"></a>fixed_effects_comparison <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(models_list, <span class="sc">~</span><span class="fu">tidy</span>(., <span class="at">effects =</span> <span class="st">"fixed"</span>, <span class="at">conf.int=</span><span class="cn">TRUE</span>), <span class="at">.id =</span> <span class="st">"model"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(term)</span>
<span id="cb22-10"><a href="#cb22-10"></a></span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="co"># View the comparison</span></span>
<span id="cb22-12"><a href="#cb22-12"></a>fixed_effects_comparison[<span class="dv">12</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"livch3+"</span></span>
<span id="cb22-13"><a href="#cb22-13"></a>fixed_effects_comparison[<span class="dv">17</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"ns(age, df = 2)1"</span></span>
<span id="cb22-14"><a href="#cb22-14"></a>fixed_effects_comparison[<span class="dv">18</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"ns(age, df = 2)2"</span></span>
<span id="cb22-15"><a href="#cb22-15"></a><span class="fu">head</span>(fixed_effects_comparison)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  model   effect term  estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 model_… fixed  (Int…   -1.90      0.181    -10.5   8.33e-26   -2.25      -1.54
2 glmmPQ… fixed  (Int…   -1.85      0.175    -10.6   1.59e-25   -2.19      -1.51
3 model_… fixed  (Int…   -1.91      0.180     NA    NA          -2.26      -1.55
4 model_… fixed  livc…    0.831     0.165      5.03  5.00e- 7    0.507      1.16
5 glmmPQ… fixed  livc…    0.812     0.160      5.08  4.12e- 7    0.499      1.13
6 model_… fixed  livc…    0.837     0.163     NA    NA           0.517      1.15
# ℹ 2 more variables: df &lt;dbl&gt;, component &lt;chr&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Plot fixed effects using ggplot2</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="fu">ggplot</span>(fixed_effects_comparison, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> model, <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> estimate <span class="sc">-</span> std.error, <span class="at">xmax =</span> estimate <span class="sc">+</span> std.error), <span class="at">height =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>term, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Coefficient Plot of Fixed Effects"</span>,</span>
<span id="cb24-7"><a href="#cb24-7"></a>       <span class="at">x =</span> <span class="st">"Estimate"</span>,</span>
<span id="cb24-8"><a href="#cb24-8"></a>       <span class="at">y =</span> <span class="st">"Model"</span>) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>The coefficient plot visualizes fixed-effect estimates for three different models: <code>model_glmer</code>, <code>model_brms</code>, and <code>glmmPQL_model</code>, across predictors including natural splines for age (<code>ns(age, df=2)</code>), number of living children (<code>livch1</code>, <code>livch2</code>, <code>livch3+</code>), and urban residency (<code>urbanY</code>). The plot demonstrates that the models produce consistent estimates with overlapping confidence intervals for most predictors, particularly for <code>model_glmer</code> and <code>model_brms</code>, which align closely. In contrast, <code>glmmPQL_model</code> exhibits more variability and narrower confidence intervals, diverging slightly for some coefficients. Notably, the <code>Intercept</code> and <code>ns(age, df=2)[2]</code> show a greater disparity between <code>glmmPQL_model</code> and the other two. These differences may reflect methodological variances in estimation techniques, underscoring the importance of model selection based on context and assumptions.</p>
<p>Penalized Quasi-Likelihood (PQL) can be a valuable tool, especially in specific situations like smaller datasets, complex random effects structures, or when other methods face convergence challenges. However, the differences observed in your coefficient plot suggest that the divergence of <code>glmmPQL_model</code> from <code>glmer</code> and <code>brms</code> may stem from known limitations of the PQL approach, even within its intended use cases.</p>
<p>PQL’s iterative nature and reliance on linearization at each step make it sensitive to the complexity of the model and the scale of the data. For example, in models with highly nonlinear relationships (such as those involving natural splines for age), the approximation process can lead to biased fixed-effect estimates. Furthermore, its point estimates might differ more noticeably when the sample size is small, as it does not fully maximize or integrate the likelihood like <code>glmer</code> or <code>brms</code>.</p>
<p>While PQL is robust in avoiding convergence issues where likelihood-based methods might struggle, its performance might trade off precision or accuracy in parameter estimation. The observed discrepancies in your plot could therefore highlight the method’s limitations in fully capturing the variability or structure of the data compared to the more modern and computationally intensive approaches like maximum likelihood or Bayesian estimation.</p>
<p>This does not discredit PQL as a method but rather emphasizes its situational utility. In our case, it may be worth investigating whether data characteristics (e.g., the number of grouping levels or the distribution of the response variable) align with PQL’s strengths, or if model simplification could alleviate convergence issues in <code>glmer</code> or <code>brms</code>.</p>
</section>
</section>
<section id="plot-of-the-random-effect-of-urban-for-each-district" class="level1">
<h1>Plot of the Random Effect of Urban for Each District</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Extract random effects and include conditional variances</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>random_effects <span class="ot">&lt;-</span> <span class="fu">ranef</span>(model_glmer, <span class="at">condVar =</span> <span class="cn">TRUE</span>, <span class="at">drop =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="co"># Extract random effects as a data frame</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>random_effects_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(random_effects<span class="sc">$</span>district)</span>
<span id="cb25-6"><a href="#cb25-6"></a></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="co"># Add district names as a column (row names represent grouping factor)</span></span>
<span id="cb25-8"><a href="#cb25-8"></a>random_effects_df<span class="sc">$</span>district <span class="ot">&lt;-</span> <span class="fu">rownames</span>(random_effects<span class="sc">$</span>district)</span>
<span id="cb25-9"><a href="#cb25-9"></a></span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="co"># Rename columns for clarity</span></span>
<span id="cb25-11"><a href="#cb25-11"></a><span class="fu">colnames</span>(random_effects_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"intercept"</span>, <span class="st">"urban_effect"</span>, <span class="st">"district"</span>)</span>
<span id="cb25-12"><a href="#cb25-12"></a></span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="co"># Plot: Random Intercept vs. Random Effect of Urban Residency</span></span>
<span id="cb25-14"><a href="#cb25-14"></a><span class="fu">ggplot</span>(random_effects_df, <span class="fu">aes</span>(<span class="at">x =</span> urban_effect, <span class="at">y =</span> intercept)) <span class="sc">+</span></span>
<span id="cb25-15"><a href="#cb25-15"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"#E74C3C"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x) <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-18"><a href="#cb25-18"></a>    <span class="at">title =</span> <span class="st">"Random Intercept vs. Random Effect of Urban Residency by District"</span>,</span>
<span id="cb25-19"><a href="#cb25-19"></a>    <span class="at">x =</span> <span class="st">"Random Effect of Urban Residency"</span>,</span>
<span id="cb25-20"><a href="#cb25-20"></a>    <span class="at">y =</span> <span class="st">"Random Intercept"</span></span>
<span id="cb25-21"><a href="#cb25-21"></a>  ) <span class="sc">+</span></span>
<span id="cb25-22"><a href="#cb25-22"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-24"><a href="#cb25-24"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb25-25"><a href="#cb25-25"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb25-26"><a href="#cb25-26"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="cn">NA</span>)</span>
<span id="cb25-27"><a href="#cb25-27"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_5_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The scatterplot depicts the relationship between the random intercepts and the random effects of urban residency across districts, derived from a mixed-effects model. Each point represents a district, and the red dashed line indicates a negative linear trend. The random intercept decreases as the random effect of urban residency increases, suggesting an inverse correlation. This relationship highlights that districts with higher urban residency effects tend to have lower random intercepts, implying potential interdependence between these random components in the model. The clear downward slope aligns with the use of random effects to capture variability across districts, ensuring the model accounts for such interactions in urban residency’s impact on the outcome.</p>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This analysis revisits the determinants of contraceptive use in Bangladesh, drawing on the 1989 Bangladesh Fertility Survey (BFS) and employing three multilevel logistic regression models: model_glmer, model_brms, and glmmPQL_model. The results reaffirm the significant roles of key predictors, including age, number of living children, and urban residency, in shaping contraceptive use patterns. The consistency of fixed-effect estimates across models, particularly between model_glmer and model_brms, strengthens the reliability of the findings, while the divergence observed in glmmPQL_model highlights the methodological differences inherent in estimation techniques.</p>
<p>As in the original study, urban residency and the number of living children are positively associated with contraceptive use. Urban women exhibit higher odds of adopting contraception (OR = 2.17, p &lt; 0.001), consistent with earlier findings linking urban residency to improved access to education, independence, and family planning resources. Similarly, the positive relationship between parity and contraceptive use aligns with previous conclusions, reinforcing the critical role of family size in influencing contraceptive decisions. The non-linear association between age and contraceptive use, with peak usage observed at middle ages, complements the original study’s findings and provides additional granularity to demographic trends.</p>
<p>The scatterplot of random intercepts and random effects of urban residency revealed an inverse relationship, indicating that districts with higher urban residency impacts tend to have lower baseline levels of contraceptive use. This suggests potential interactions between district-level characteristics and urban residency, echoing the original study’s emphasis on localized disparities in access to family planning resources. The hierarchical approach taken here further highlights how district-level variability shapes contraceptive use patterns and adds a layer of complexity to understanding urban-rural differences.</p>
<p>Lastly, the comparison of methods emphasizes the importance of model selection. While glmmPQL_model offers advantages in handling convergence issues, its divergence from model_glmer and model_brms suggests limitations in capturing non-linear relationships and hierarchical effects as effectively. These results suggest that maximum likelihood (glmer) and Bayesian methods (brms) provide more robust and accurate estimates for this type of analysis. Overall, the findings validate and expand upon the conclusions of the original study, offering updated insights into the demographic, socio-economic, and contextual factors that influence contraceptive use in Bangladesh.<br>
<br>
<br>
</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><p>Barr, Dale J., Roger Levy, Christoph Scheepers, and Harry J. Tily. 2013. “Random Effects Structure for Confirmatory Hypothesis Testing: Keep It Maximal.” Journal of Memory and Language 68 (3): 255–78. https://doi.org/10.1016/j.jml.2012.11.001.</p></li>
<li><p>Bates, Douglas, Reinhold Kliegl, Shravan Vasishth, and Harald Baayen. 2015. “Parsimonious Mixed Models.” arXiv:1506.04967 [Stat], June. https://arxiv.org/abs/1506.04967.</p></li>
<li><p>Bates, Douglas, Martin Mächler, Ben Bolker, and Steve Walker. 2015. “Fitting Linear MixedEffects Models Using Lme4.” Journal of Statistical Software 67 (October): 1–48. https://doi. org/10.18637/jss.v067.i01.</p></li>
<li><p>Biswas, Keya. 2015. “Performances of Different Estimation Methods for Generalized Linear Mixed Models.” Master’s thesis, McMaster University. https://macsphere.mcmaster.ca/ bitstream/11375/17272/2/M.Sc_Thesis_final_Keya_Biswas.pdf.</p></li>
<li><p>Bolker, Benjamin M. 2015. “Generalized Linear Mixed Models.” In Ecological Statistics: Contemporary Theory and Application, edited by Gordon A. Fox, Simoneta Negrete-Yankelevich, and Vinicio J. Sosa. Oxford University Press.</p></li>
<li><p>Bolker, Benjamin M. 2008. “Ecological Models and Data in R”</p></li>
<li><p>Booth, James G., and James P. Hobert. 1999. “Maximizing Generalized Linear Mixed Model Likelihoods with an Automated Monte Carlo EM Algorithm.” Journal of the Royal Statistical Society. Series B 61 (1): 265–85. https://doi.org/10.1111/1467-9868.00176.</p></li>
<li><p>Breslow, N. E. 2004. “Whither PQL?” In Proceedings of the Second Seattle Symposium in Biostatistics: Analysis of Correlated Data, edited by Danyu Y. Lin and P. J. Heagerty, 1–22. Springer.</p></li>
<li><p>Crawley, Michael J. 2002. Statistical Computing: An Introduction to Data Analysis Using S-PLUS. John Wiley &amp; Sons.</p></li>
<li><p>Gelman, Andrew. 2005. “Analysis of Variance: Why It Is More Important Than Ever.” Annals of Statistics 33 (1): 1–53. https://doi.org/doi:10.1214/009053604000001048.</p></li>
<li><p>Gelman, Andrew and Jakulin, Aleks and Pittau, Maria Grazia and Su, Yu-Sung, 2008. “A weakly informative default prior distribution for logistic &amp; other regression models”</p></li>
<li><p>K. Banos, 20024. “Assignment 2”</p></li>
<li><p>Matuschek, Hannes, Reinhold Kliegl, Shravan Vasishth, Harald Baayen, and Douglas Bates.</p>
<ol start="2017" type="1">
<li>“Balancing Type I Error and Power in Linear Mixed Models.” Journal of Memory and Language 94 (June): 305–15. https://doi.org/10.1016/j.jml.2017.01.001.</li>
</ol></li>
<li><p>Murtaugh, Paul A. 2007. “Simplicity and Complexity in Ecological Data Analysis.” Ecology 88 (1): 56–62. http://www.esajournals.org/doi/abs/10.1890/0012-9658%282007%2988%5B5 6%3ASACIED%5D2.0.CO%3B2.</p></li>
<li><p>Pinheiro, José C., and Douglas M. Bates. 1996. “Unconstrained Parametrizations for VarianceCovariance Matrices.” Statistics and Computing 6 (3): 289–96. https://doi.org/10.1007/BF</p>
<ol start="140873" type="1">
<li></li>
</ol></li>
<li><p>Ponciano, José Miguel, Mark L. Taper, Brian Dennis, and Subhash R. Lele. 2009. “Hierarchical Models in Ecology: Confidence Intervals, Hypothesis Testing, and Model Selection Using Data Cloning.” Ecology 90 (2): 356–62. http://www.jstor.org/stable/27650990.</p></li>
<li><p>Stroup, Walter W. 2014. “Rethinking the Analysis of Non-Normal Data in Plant and Soil Science.” Agronomy Journal 106: 1–17. https://doi.org/10.2134/agronj2013.0342.</p></li>
<li><p>Sung, Yun Ju, and Charles J. Geyer. 2007. “Monte Carlo Likelihood Inference for Missing Data Models.” The Annals of Statistics 35 (3): 990–1011. https://doi.org/10.1214/009053606000</p></li>
<li><p>Harrell, Frank E. 2015. “Regression Modeling Strategies: With Applications to Linear Models, Logistic and Ordinal Regression, and Survival Analysis”</p></li>
<li><p>I read assignments for previous years in order to gain some great code ideas and identify previous mistakes inorder to avoid them.</p></li>
<li><p>I used Chat Gpt extensively to create reports (I was writting my conclusions and after that, I was asking Chat Gpt to write it in a formal way as a report).</p></li>
<li><p>I used chat-gpt to code some plots I didnt know and create a more professional output.</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>